<?php if(!defined('BASEPATH'))exit('No direct script access alloed');class Master_model extends CI_Model{public function getRecordCount($tbl_name,$condition=FALSE){$this->db->cache_on();if($condition!=""&&count($condition)>0){foreach($condition as $key=>$val){$this->db->where($key,$val);}}$num=$this->db->count_all_results($tbl_name);return $num;}public function getRecords($tbl_name,$condition=FALSE,$select=FALSE,$order_by=FALSE,$start=FALSE,$limit=FALSE){$this->db->cache_on();if($select!=""){$this->db->select($select,FALSE);}if(count($condition)>0&&$condition!=""){$condition=$condition;}else{$condition=array();}if(count($order_by)>0&&$order_by!=""){foreach($order_by as $key=>$val){$this->db->order_by($key,$val);}}if($limit!=""||$start!=""){$this->db->limit($limit,$start);}$rst=$this->db->get_where($tbl_name,$condition);return $rst->result_array();}public function insertRecord($tbl_name,$data_array,$insert_id=FALSE){$this->db->cache_delete_all();foreach(array_keys($data_array)as $a){if(!$this->db->field_exists($a,$tbl_name)){unset($data_array[$a]);}}if($this->db->insert($tbl_name,$data_array)){if($insert_id==true){return $this->db->insert_id();}else{return true;}}else{return false;}}public function updateRecord($tbl_name,$data_array,$where_arr){$this->db->cache_delete_all();foreach(array_keys($data_array)as $a){if(!$this->db->field_exists($a,$tbl_name)){unset($data_array[$a]);}}$this->db->where($where_arr,NULL,FALSE);if($this->db->update($tbl_name,$data_array)){return true;}else{return false;}}public function deleteRecord($tbl_name,$pri_col,$id){$this->db->cache_delete_all();$this->db->where($pri_col,$id);if($this->db->delete($tbl_name)){return true;}else{return false;}}public function createThumb($file_name,$path,$width,$height,$maintain_ratio=FALSE){$config_1['image_library']='gd2';$config_1['source_image']=$path.$file_name;$config_1['create_thumb']=TRUE;$config_1['maintain_ratio']=$maintain_ratio;$config_1['thumb_marker']='';$config_1['new_image']=$path."small/".$file_name;$config_1['width']=$width;$config_1['height']=$height;$this->load->library('image_lib',$config_1);$this->image_lib->initialize($config_1);$this->image_lib->resize();if(!$this->image_lib->resize())echo $this->image_lib->display_errors();}function create_slug($phrase,$tbl_name,$title_col,$pri_col='',$id='',$maxLength=100000000000000){$result=strtolower($phrase);$slug=url_title($result,'_');if($id!=""){$this->db->where($pri_col.' !=',$id);}$rst=$this->db->get_where($tbl_name,array($title_col=>$slug));if($rst->num_rows()>0){$count=$rst->num_rows()+1;return $slug=$slug.$count;}else{return $slug;}}function getAdminMenu(){global $OOZADMINMENU,$OOZSETTINGS;$str="";$class="";$classf=" first";if($OOZADMINMENU){unset($OOZADMINMENU["100004"]);if(!$OOZSETTINGS["lang"]){unset($OOZADMINMENU["100005"]);}foreach($OOZADMINMENU as $k=>$v){if(@$this->mAccess[$v["seoUri"]]){$class=str_replace("admin-","",$v["seoUri"]);$str.=' <li><a class="'.$class.$classf.' left" href="'.base_url().'myadmin/'.$v["dUri"].'/" title="'.$v["menuTitle"].'"><i class="fa fa-cog"></i> '.$v["menuTitle"].'</a></li>';$classf='';}}}return $str;}public function getAdminSMenu(){global $OOZACCESS;$str="";$strS="";$sql=$this->getRecords('admin_menu',array('status'=>'1','parentID'=>'0'),'',array('xOrder'=>'ASC'));if(count($sql)>0){$main=$sql;foreach($main as $v){$sql=$this->getRecords('admin_menu',array('parentID'=>$v['adminMenuID']),'',array('xOrder'=>'ASC'));$strT="";$classM="";$strS="";$strAdd="";$classA="";$strAdd="";$strMain="";$strAW="";$strDisplay="";$classL="";$icon="fa-book";if(count($sql)){$sub=$sql;foreach($sub as $d){$this->mAccess[$d["seoUri"]]=$OOZACCESS;if($this->mAccess[$d["seoUri"]]){$classA="";$classL="";if($this->pageUri==$d["seoUri"]."-".$this->pageType){if($this->pageType=="add"){$classA=' aactive';$classM=' class="active"';}else{$classL=' class="active"';$classM=' class="active"';}}$strAdd="";if(in_array("add",$this->mAccess[$d["seoUri"]]))$strAdd.='<ul><li '.$classA.'><a href="'.base_url().'myadmin/'.$d["seoUri"].'/add/" class="add" title="Add New '.$d["menuTitle"].'">Add '.$d["menuTitle"].'</a></li><li '.$classL.'><a href="'.base_url().'myadmin/'.$d["seoUri"].'/listview/" class="list" title="List '.$d["menuTitle"].'">Manage '.$d["menuTitle"].'</a></li></ul>';$strT.='<li><span><a href="'.base_url().'myadmin/'.$d["seoUri"].'/listview/""'.$classL.'>'.$d["menuTitle"].'</a></span>'.$strAdd.'</li>';}}if($this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/listview"||$this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/add"||$this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/edit")$classM=' class="active"';if($this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/add"||$this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/edit")$classA=' active';if($this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/listview")$classL=' class="active"';if(in_array("add",$this->mAccess[$v["seoUri"]])){if($classM==' class="active"'){$strDisplay='style="display:block;"';}$strAdd='<li '.$classA.'><a href="'.base_url().'myadmin/'.$v["seoUri"].'/add/" class="add" title="Add New '.$v["menuTitle"].'">Add '.$v["menuTitle"].'</a></li><li '.$classL.'><a href="'.base_url().'myadmin/'.$v["seoUri"].'/listview/" class="list" title="List '.$v["menuTitle"].'">Manage '.$v["menuTitle"].'</a></li>';$strMain='href="#" class="dropdown-toggle"';if($this->uri->segment(2)==$v["seoUri"]){$strAW='fa-angle-down';}else{$strAW='fa-angle-right';}$strArrow='<span class="menu-arrow"></span>';}else{$strMain='href="'.base_url().'myadmin/'.$v["seoUri"].'/listview/""';$strArrow='';$strAdd='';}if($v["menuImage"]!=''){$icon=$v["menuImage"];}if($strT){$strS='<ul  class="submenu" '.$strDisplay.'>'.$strAdd.''.$strT.'</ul>';$str.='<li '.$classM.'><a '.$strMain.' ><i class="fa '.$icon.'"></i><span>'.$v["menuTitle"].'</span>'.$strArrow.'</a>'.$strS.'</li>';}}else{if($this->mAccess[$v["seoUri"]]){$classA="";$strAdd="";$strMain="";$strAW="";$strDisplay="";$classL="";$icon="fa-book";if($this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/listview"||$this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/add"||$this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/edit")$classM=' class="active"';if($this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/add"||$this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/edit")$classA=' active';if($this->uri->segment(2).'/'.$this->uri->segment(3)==$v["seoUri"]."/listview")$classL=' class="active"';if(in_array("add",$this->mAccess[$v["seoUri"]])){if($v['seoUri']=='dashboard'){$strMain='href="'.base_url().'myadmin/'.$v["seoUri"].'/listview/""';$strArrow='';$strAdd='';}else{if($classM==' class="active"'){$strDisplay='style="display:block;"';}$strAdd='<ul class="submenu" '.$strDisplay.'><li '.$classA.'><a href="'.base_url().'myadmin/'.$v["seoUri"].'/add/" class="add" title="Add New '.$v["menuTitle"].'">Add '.$v["menuTitle"].'</a></li><li '.$classL.'><a href="'.base_url().'myadmin/'.$v["seoUri"].'/listview/" class="list" title="List '.$v["menuTitle"].'">Manage '.$v["menuTitle"].'</a></li></ul>';$strMain='href="#" class="dropdown-toggle waves-effect"';if($this->uri->segment(2)==$v["seoUri"]){$strAW='fa-angle-down';}else{$strAW='fa-angle-right';}$strArrow='<span class="menu-arrow"></span>';}}else{$strMain='href="'.base_url().'myadmin/'.$v["seoUri"].'/listview/""';$strArrow='';$strAdd='';}if($v["menuImage"]!=''){$icon=$v["menuImage"];}$str.='<li '.$classM.'><a '.$strMain.' ><i class="fa '.$icon.'"></i><span>'.$v["menuTitle"].'</span>'.$strArrow.'</a>'.$strAdd.'</li>';}}}}return $str;}public function video_image($url){$image_url=parse_url($url);if($image_url['host']=='www.youtube.com'||$image_url['host']=='youtube.com'){$array=explode("&",$image_url['query']);return "http://img.youtube.com/vi/".substr($array[0],2)."/0.jpg";}else if($image_url['host']=='www.vimeo.com'||$image_url['host']=='vimeo.com'){$hash=unserialize(file_get_contents("http://vimeo.com/api/v2/video/".substr($image_url['path'],1).".php"));return $hash[0]["thumbnail_large"];}}public function getDepthArray($result,$fldParent="",$fldId="",$parent=0,$level=0,$finalArr=array(),$rt=true){if(sizeof($result)>0&&$fldParent&&$fldId){foreach($result as $rs){if($rs[$fldParent]==$parent){$rs['depth']=$level++;$finalArr[]=$rs;$rt=false;$finalArr=$this->getDepthArray($result,$fldParent,$fldId,$rs[$fldId],$level,$finalArr,$rt);$level--;}}}return $rt?$result:$finalArr;}public function getDepthArrayCustome($result,$fldParent="",$fldId="",$parent=0,$level=0,$finalArr=array(),$rt=true){if(sizeof($result)>0&&$fldParent&&$fldId){foreach($result as $rs){if($rs[$fldParent]==$parent){$rs['depth']=$level++;if($rs['depth']!='2'){$finalArr[]=$rs;}$rt=false;if($rs['depth']!='3'){$finalArr=$this->getDepthArrayCustome($result,$fldParent,$fldId,$rs[$fldId],$level,$finalArr,$rt);}$level--;}}}return $rt?$result:$finalArr;}public function getTreeDD($arrD=array(),$val="categoryID",$text="categoryTitle",$nmParent="parentID",$selected=""){$options="";$arr=$this->getDepthArray($arrD,$nmParent,$val);if(!empty($arr)&&sizeof($arr)>=1&&is_array($arr)){foreach($arr as $k=>$v){if($v){$sel="";if($v[$val]=="$selected")$sel=' selected="selected"';if($v["depth"])$v[$text]=str_repeat("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",$v["depth"])."&rArr; ".$v[$text];$options.="\n<option value=\"".$v[$val]."\"".$sel.">".$v[$text]."</option>";}}}return $options;}function secondsToTime($seconds){$hours=floor($seconds/(60*60));$divisor_for_minutes=$seconds%(60*60);$minutes=floor($divisor_for_minutes/60);$divisor_for_seconds=$divisor_for_minutes%60;$seconds=ceil($divisor_for_seconds);$obj=array("h"=>(int) $hours,"m"=>(int) $minutes,"s"=>(int) $seconds,);return $obj;}function time_ago($timestamp){$output="";$now=time();$createtime=strtotime($timestamp);$difference=abs($now-$createtime);$years=floor($difference/(365*60*60*24));$months=floor(($difference-$years*365*60*60*24)/(30*60*60*24));$days=floor(($difference-$years*365*60*60*24-$months*30*60*60*24)/(60*60*24));$hours=floor($difference/3600);$minutes=floor($difference/60);$seconds=floor($difference);if($output==""){if($years>1){$output=$years." years ago";}elseif($years==1){$output=$years." year ago";}}if($output==""){if($months>1){$output=$months." months ago";}elseif($months==1){$output=$months." month ago";}}if($output==""){if($days>1){$output=$days." days ago";}elseif($days==1){$output=$days." day ago";}}if($output==""){if($hours>1){$output=$hours." hours ago";}elseif($hours==1){$output=$hours." hour ago";}}if($output==""){if($minutes>1){$output=$minutes." minutes ago";}elseif($minutes==1){$output=$minutes." minute ago";}}if($output==""){if($seconds>1){$output=$seconds." seconds ago";}elseif($seconds==1){$output=$seconds." second ago";}}return $output;}public function fetch_data($tbl_name,$select=FALSE,$join=FALSE,$where_like=FALSE,$where=FALSE,$order_column=FALSE,$table_head=FALSE,$order_by=FALSE,$pagination=FALSE){if($select!=''){$this->db->select($select);$this->db->from($tbl_name);}if($join!=''){foreach($join as $key=>$join_condition){if($join_condition['join_type']==''){$this->db->join($join_condition['table'],$join_condition['join_table_id'].'='.$join_condition['from_table_id']);}else{$this->db->join($join_condition['table'],$join_condition['join_table_id'].'='.$join_condition['from_table_id'],$join_condition['join_type']);}}}if($where_like!=''){if($this->input->post('search')['value']){$this->db->where($where_like);}}if($where!=''){$this->db->where($where);}$recordfilter_query=$this->db->get();$recordsFiltered=$recordfilter_query->num_rows();if($select!=''){$this->db->select($select);$this->db->from($tbl_name);}if($join!=''){foreach($join as $key=>$join_condition){if($join_condition['join_type']==''){$this->db->join($join_condition['table'],$join_condition['join_table_id'].'='.$join_condition['from_table_id']);}else{$this->db->join($join_condition['table'],$join_condition['join_table_id'].'='.$join_condition['from_table_id'],$join_condition['join_type']);}}}if($where_like!=''){if($this->input->post('search')['value']){$this->db->where($where_like);}}if($this->input->post("length")!=-1){$this->db->limit($this->input->post('length'),$this->input->post('start'));}if($where!=''){$this->db->where($where);}$fetch_query=$this->db->get();$fetch_data=$fetch_query->result();$data=array();$cnt=$this->input->post('start')+1;if($select!=''){$this->db->select($select);$this->db->from($tbl_name);}if($join!=''){foreach($join as $key=>$join_condition){if($join_condition['join_type']==''){$this->db->join($join_condition['table'],$join_condition['join_table_id'].'='.$join_condition['from_table_id']);}else{$this->db->join($join_condition['table'],$join_condition['join_table_id'].'='.$join_condition['from_table_id'],$join_condition['join_type']);}}}if($where!=''){$this->db->where($where);}$recordsTotal=$this->db->count_all_results();$output=array("draw"=>intval($this->input->post("draw")),"recordsTotal"=>$recordsTotal,"recordsFiltered"=>$recordsFiltered,"data"=>$fetch_data);return $output;}public function getPageByID($id,$website_id){$result=$this->db->get_where('fx_page',array('pageID ='=>$id,'website_id'=>$website_id))->row();return $result;}public function getSeasonByID($id,$website_id){$result=$this->db->get_where('fx_newseason',array('newseasonID ='=>$id,'website_id'=>$website_id))->row();return $result;}public function getVideoByID($id){$data=array();$last_data='';$sub_dategory_data='';$category=$this->db->get_where('fx_category',array('categoryID ='=>$id,'website_id'=>WEBSITEID,'status'=>'1'))->row();$data['description_title']=$category->categoryTitle;$data['category_descripation']=$category->description;$result=$this->db->get_where('fx_videos',array('categoryID ='=>$id,'website_id'=>WEBSITEID,'status'=>'1'))->result_array();$sub_dategory=$this->db->get_where('fx_category',array('parentID ='=>$id,'website_id'=>WEBSITEID,'status'=>'1'))->result_array();$result1=$this->db->get_where('fx_videos',array('categoryID ='=>$id,'bannerStatus'=>'1','website_id'=>WEBSITEID,'status'=>'1'))->row();$video_id=explode("?v=",$result1->youtubeLink);$video_id=$video_id[1];$thumbnail="http://img.youtube.com/vi/".$video_id."/maxresdefault.jpg";$html='<div class="imgBx"><a class="popup-youtube" href="'.$result1->youtubeLink.'"><span><i class="fa fa-youtube-play" aria-hidden="true"></i></span><img src="'.$thumbnail.'" alt=""></a></div> 
                <a class="popup-youtube" href="'.$result1->youtubeLink.'"><h2>'.$result1->videosTitle.'</h2></a>';$record='<div class="title">
            <h2>'.$category->categoryTitle.'</h2>
            <div class="rightTitle">
                <div class="sortDD dropdownDD">
            	<input type="hidden" name="category_id" id="category_id" value="'.$id.'">
            	<select name="filter" id="filter" class="filter"><option value="0">All</option>';foreach($sub_dategory as $key=>$value){$sub_dategory_data.='<option value="'.$value['categoryID'].'">'.$value['categoryTitle'].'</option>';}$last_data='</select>
            </div>
            </div>
        </div>
        <ul class="listing">';$record=$record.$sub_dategory_data.$last_data;$record2='</ul>';if(!empty($result)){foreach($result as $key=>$value){$video_id1=explode("?v=",$value['youtubeLink']);$video_id1=$video_id1[1];$thumbnail1="http://img.youtube.com/vi/".$video_id1."/maxresdefault.jpg";$record1.=' 
	                    <li>
	                        <div class="imgBx"><a class="popup-youtube" href="'.$value['youtubeLink'].'"><span><i class="fa fa-youtube-play" aria-hidden="true"></i></span><img src="'.$thumbnail1.'" alt=""></a></div>
	                        <a class="popup-youtube" href="'.$value['youtubeLink'].'"><h2>'.$value['videosTitle'].'</h2></a>
	                    </li>';}$data['video_listing']=$record.$record1.$record2;}else{$record1='<p>No Record Found...!!!</p>';$data['video_listing']=$record.$record1.$record2;}$data['category_title']=$html;return $data;}public function fetchsubcategoryByID(){$html='';$data=array();$result=$this->db->get_where('fx_category',array('parentID ='=>$this->input->post('category_id'),'website_id'=>$this->session->userdata('website_id'),'status'=>'1'))->result_array();if($result){foreach($result as $key=>$value){$html.='<option value="'.$value['categoryID'].'">'.$value['categoryTitle'].'</option>';}$data['status']='success';$data['data']=$html;}else{$data['status']='error';$data['data']='';}return $data;}public function video_displayByFilter(){$html1='';$html='';$html2='';$data=array();if($this->input->post('subcategory_id')==0){$result=$this->db->get_where('fx_videos',array('categoryID ='=>$this->input->post('categoryID'),'website_id'=>WEBSITEID,'status'=>'1'))->result_array();}else{$result=$this->db->get_where('fx_videos',array('categoryID ='=>$this->input->post('categoryID'),'subcategoryID = '=>$this->input->post('subcategory_id'),'website_id'=>WEBSITEID,'status'=>'1'))->result_array();}if($result){$html='<ul class="listing">';foreach($result as $key=>$value){$video_id1=explode("?v=",$value['youtubeLink']);$video_id1=$video_id1[1];$thumbnail1="http://img.youtube.com/vi/".$video_id1."/maxresdefault.jpg";$html1.='<li>
	                        <div class="imgBx"><a class="popup-youtube" href="'.$value['youtubeLink'].'"><span><i class="fa fa-youtube-play" aria-hidden="true"></i></span><img src="'.$thumbnail1.'" alt=""></a></div>
	                        <a class="popup-youtube" href="'.$value['youtubeLink'].'"><h2>'.$value['videosTitle'].'</h2></a>
	                    </li>';}$html2='</ul>';$html=$html.$html1.$html2;$data['status']='success';$data['data']=$html;}else{$data['status']='error';$data['data']='';}return $data;}public function getDescrByID($id){$data=array();$category=$this->db->get_where('fx_category',array('categoryID ='=>$id,'website_id'=>WEBSITEID,'status'=>'1'))->row();if(!empty($category)){$data['category_title']=$category->categoryTitle;$data['category_descripation']=$category->description;}else{$data['category_title']='';$data['category_descripation']='';}return $data;}public function video_displayBycategory(){$html1='';$html='';$html2='';$data=array();if($this->input->post('categoryID')==0){$data['category_title']='All';$result=$this->db->get_where('fx_videos',array('website_id'=>WEBSITEID,'status'=>'1'))->result_array();}else{$category=$this->db->get_where('fx_category',array('categoryID ='=>$this->input->post('categoryID'),'website_id'=>WEBSITEID,'status'=>'1'))->row();$data['category_title']=$category->categoryTitle;$result=$this->db->get_where('fx_videos',array('categoryID ='=>$this->input->post('categoryID'),'website_id'=>WEBSITEID,'status'=>'1'))->result_array();}if($result){foreach($result as $key=>$value){$video_id1=explode("?v=",$value['youtubeLink']);$video_id1=$video_id1[1];$thumbnail1="http://img.youtube.com/vi/".$video_id1."/maxresdefault.jpg";$html1.='<li>
	                        <div class="imgBx"><a class="popup-youtube" href="'.$value['youtubeLink'].'"><span><i class="fa fa-youtube-play" aria-hidden="true"></i></span><img src="'.$thumbnail1.'" alt=""></a></div>
	                        <a class="popup-youtube" href="'.$value['youtubeLink'].'"><h2>'.$value['videosTitle'].'</h2></a>
	                    </li>';}$data['status']='success';$data['data']=$html1;}else{$data['status']='error';$data['data']='';}return $data;}public function search_shows($title){$data=array();$this->db->like('ourshowsTitle',$title);$shows=$this->db->get_where('fx_our_shows',array('website_id'=>WEBSITEID,'status'=>1))->result_array();return $shows;}public function search_videos($title){$data=array();$this->db->like('videosTitle',$title);$videos=$this->db->get_where('fx_videos',array('website_id'=>WEBSITEID,'status'=>1))->result_array();return $videos;}public function autocomplete_search($search){$data=array();$skillData=array();$html='';$html1='';$function_name='';if(!empty($search)){$this->db->select('videosTitle');$this->db->from('fx_videos');$this->db->where('website_id',WEBSITEID);$this->db->where('status',1);$this->db->like('videosTitle',$search);$videos=$this->db->get()->result_array();$this->db->select('ourshowsTitle');$this->db->from('fx_our_shows');$this->db->where('website_id',WEBSITEID);$this->db->where('status',1);$this->db->like('ourshowsTitle',$search);$shows=$this->db->get()->result_array();$result=array_merge($videos,$shows);if($this->input->post('search_by')==1){$function_name="selectSearch";}elseif($this->input->post('search_by')==2){$function_name="selectSearch1";}else{$function_name="selectSearch2";}if(!empty($result)){if(count($result)>5){$html1='<li class="brdr"><a href="'.base_url('home/search?s='.$search).'">View All Results</a></li>';}$i=1;foreach($result as $key=>$value){if($i<=5){$search_title=($value['videosTitle'])?$value['videosTitle']:$value['ourshowsTitle'];$search_title1="'".implode("','",explode(',',$search_title))."'";$html.='<li onClick="'.$function_name.'('.$search_title1.')">'.$search_title.'</li>';}$i++;}$html=$html1.$html;}else{$html.='<li>No Record Found</li>';}}return $html;}} ?>