<?php if(!defined('BASEPATH'))exit('No direct script access allowed');class Admin extends CI_Controller{public function __construct(){parent::__construct();$this->load->library('upload');}public function login(){$data=array();if(isset($_POST['btn_login'])&&$_POST['btn_login']=='btn_login'){$this->form_validation->set_rules('userEmail','','required');$this->form_validation->set_rules('password','','required');if($this->form_validation->run()){$userEmail=$this->input->post('userEmail',true);$password=$this->input->post('password',true);if(loginAdminUser($userEmail,$password)){if($_POST['redirect']!=''){redirect(base_url().$_POST['redirect']);}else{redirect(base_url().'myadmin/sliders/listview');}}else{$data['error']='Invalid username or password !';}}}$this->load->view('admin/login',$data);}public function dashboard(){$data['success']=$data['error']='';$data['middle_content']='dashboard';$this->load->view('admin/common-file',$data);}public function setting(){$data['success']=$data['error']='';$data['middle_content']='setting';$D=$data['D']=getSetting();if(isset($_POST)&&!empty($_POST)){$config=array('upload_path'=>'uploads/admin/','allowed_types'=>'jpg|jpeg|gif|png','file_name'=>rand(1,9999),'max_size'=>0);$this->upload->initialize($config);if($_FILES['logo_upload']['name']!=''){if($this->upload->do_upload('logo_upload')){$dt=$this->upload->data();$_POST['logo']=$dt['file_name'];}else{$_POST['logo']=$_POST['old_logo'];$data['error']=$this->upload->display_errors();}}else{$_POST['logo']=$_POST['old_logo'];}$config1=array('upload_path'=>'uploads/admin/','allowed_types'=>'jpg|jpeg|gif|png|ico','file_name'=>rand(1,9999),'max_size'=>0);$this->upload->initialize($config1);if($_FILES['fav_upload']['name']!=''){if($this->upload->do_upload('fav_upload')){$dt=$this->upload->data();$_POST['favicon']=$dt['file_name'];}else{$_POST['favicon']=$_POST['old_fav'];$data['error']=$this->upload->display_errors();}}else{$_POST['favicon']=$_POST['old_fav'];}foreach($D as $seoUri=>$v){$this->master_model->updateRecord('admin_setting',array("settingVal"=>$_POST[$seoUri]),array('seoUri'=>'"'.$seoUri.'"'));}$this->session->set_flashdata('success','Records updated successfully');redirect(base_url().'myadmin/setting/edit/');}$rows=$this->master_model->getRecords('admin_menu',array('menuType'=>'0'),'seoUri,menuTitle');if(count($rows)>0){foreach($rows as $v){$arrData[$v['seoUri']]=$v['menuTitle'];}}$data['admin_menu']=$arrData;$this->load->view('admin/common-file',$data);}public function logout(){$this->session->unset_userdata('OOZID');$this->session->unset_userdata('OOZIMAGE');$this->session->unset_userdata('OOZNAME');$this->session->unset_userdata('OOZEMAIL');$this->session->unset_userdata('OOZROLE');$this->session->unset_userdata('website_id');$this->session->unset_userdata('timer');redirect(base_url().'myadmin/admin/login/');}public function clearCache(){$this->db->cache_delete_all();redirect(base_url($this->tplDefault));}public function profile($userID,$sha1){if($userID==''||$sha1==''){show_404();}if(sha1($userID)!=$sha1){show_404();}$data['success']=$data['error']='';if(isset($_POST['birthDate'])&&!empty($_POST)){$config=array('upload_path'=>'uploads/admin/','allowed_types'=>'jpg|jpeg|gif|png','file_name'=>rand(1,9999),'max_size'=>0);$this->upload->initialize($config);if($_FILES['imageName']['name']!=''){if($this->upload->do_upload('imageName')){$dt=$this->upload->data();$_POST['imageName']=$dt['file_name'];}else{$_POST['imageName']=$_POST['old_imageName'];$data['error']=$this->upload->display_errors();}}else{$_POST['imageName']=$_POST['old_imageName'];}$_POST['birthDate']=date('Y-m-d',strtotime($_POST['birthDate']));$_POST['joiningDate']=date('Y-m-d',strtotime($_POST['joiningDate']));$_POST['leavingDate']=date('Y-m-d',strtotime($_POST['leavingDate']));$_POST['dateModified']=date('Y-m-d h:i:s');$this->master_model->updateRecord('admin_user',$_POST,array('userID'=>$userID));$this->session->set_flashdata('success','Records updated successfully');redirect(base_url().'myadmin/profile/edit/'.$userID.'/'.$sha1);}if(isset($_POST['userPass'])){$_POST["userPass"]=md5($_POST["userPass"]);$_POST['dateModified']=date('Y-m-d h:i:s');$this->master_model->updateRecord('admin_user',$_POST,array('userID'=>$userID));$this->session->set_flashdata('success1','Records updated successfully');redirect(base_url().'myadmin/profile/edit/'.$userID.'/'.$sha1);}$data['fetchValue']=$this->master_model->getRecords('admin_user',array('userID'=>$userID));$data['middle_content']='profile';$this->load->view('admin/common-file',$data);}public function set_session(){$str='';$result=array();if($this->input->post('website_id')==2){$this->session->set_userdata('website_id','2');$this->session->set_userdata('website_logo',base_url('backendAssets/front-css/images/logo_ap.jpg'));$this->session->set_userdata('website_name','Animal Plant');$str='OK';}else if($this->input->post('website_id')==3){$this->session->set_userdata('website_id','3');$this->session->set_userdata('website_logo',base_url('backendAssets/front-css/images/logo_tlc.jpg'));$this->session->set_userdata('website_name','TLC');$str='OK';}else{$this->session->set_userdata('website_id','1');$this->session->set_userdata('website_logo',base_url('backendAssets/images/menu-logo.jpg'));$this->session->set_userdata('website_name','Chimpandzinc');$str='OK';}if($str=='OK'){$result['status']='success';}else{$result['status']='error';}echo json_encode($result);exit();}}